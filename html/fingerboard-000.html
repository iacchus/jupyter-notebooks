<!DOCTYPE html>
<html>
<head><meta charset="utf-8" />
<title>fingerboard-000</title>

<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>-->
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.19.0/codemirror.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.19.0/mode/python/python.js"></script>

<script>
$(document).ready(function(){
	$('.code').each(function() {

	    var $this = $(this),
		$code = $this.html().trim();

	    $this.empty();

	    var myCodeMirror = CodeMirror(this, {
		value: $code,
		mode: 'python',
		lineNumbers: false,
		readOnly: true,
                lineWrapping: true,
                htmlMode: true,
                matchClosing: true,       
                indentWithTabs: true,
	    });

	});
});
</script>



<style type="text/css">
/* Overrides of notebook CSS for static HTML export */
body {
  overflow: visible;
  padding: 8px;
}

div#notebook {
  overflow: visible;
  border-top: none;
}

@media print {
  div.cell {
    display: block;
    page-break-inside: avoid;
  } 
  div.output_wrapper { 
    display: block;
    page-break-inside: avoid; 
  }
  div.output { 
    display: block;
    page-break-inside: avoid; 
  }
}
</style>

<!-- Custom stylesheet, it must be in the same directory as the html file -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.19.0/codemirror.css">
<link rel="stylesheet" href="https://iacchus.github.io/jupyter-ipython-themes/custom.css">

<!-- Loading mathjax macro -->
</head>
<body>
  <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="http://pythonhosted.org/svgwrite/">http://pythonhosted.org/svgwrite/</a></p>
<p><a href="http://web.mit.edu/music21/doc/moduleReference/index.html">http://web.mit.edu/music21/doc/moduleReference/index.html</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area code">
from music21 import *

import svgwrite as sw

from IPython.display import display, HTML, Image

import seaborn
from colorsys import hls_to_rgb
from base64 import b16encode
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area code">
def y_by_line(line_num, line_height):
    return (line_num) * line_height

svg_attrs = {
    'font-family': 'Inconsolata, monospace',
    'font-weight': 'bold',
}

table_attrs = {
    'stroke' : '#000',
    'fill' : '#fff',
    'stroke-width' : '1',
}

cell_attrs = {
    'fill':'none',
    'stroke':'none',
    'stroke-width':'1',
}

openstr_attrs = {
    'fill':'none',
    'stroke':'#333',
    'stroke-width':'3',
}

closestr_attrs = {
    'fill':'none',
    'stroke':'#333',
    'stroke-width':'1',
}

circ_attrs = {
    'fill':'#fff',
    'stroke':'white',
    'stroke-width':'0',
}

text_attrs = {
    'font-family': '"Inconsolata", monospace',
    'alignment-baseline' : 'middle',
    'text-anchor' : 'middle',
    'fill' : '#fff',
    'stroke' : 'none',
}

string_num = 4
string_notes = 18

width = 970
cell_width = width/18
cell_height = (cell_width/3)*2
height = cell_height*4

dwg = sw.Drawing(profile='full', size=("{}".format(width), "{}".format(height)), **svg_attrs)

dwg.add(sw.shapes.Rect(insert=(0, 0), size=(width, height), **table_attrs))

chromatic = scale.ChromaticScale()

#nts = [ pitch.Pitch('e4'),
#        pitch.Pitch('a3'),
#        pitch.Pitch('d3'),
#        pitch.Pitch('g2'),
#       ]

nts = [ chromatic.getPitches('e4', 'a5'),
        chromatic.getPitches('a3', 'd5'),
        chromatic.getPitches('d3', 'g4'),
        chromatic.getPitches('g2', 'c4'),
       ]


pal_hls = seaborn.hls_palette(7, l=.3, s=.8).as_hex()

note_colors = dict()
note_names = ['c','d','e','f','g','a','b'].sort()

#note_names = chromatic.getPitches('c4','b4')

for idx,note_name in enumerate(note_names):
    note_colors.update({note_name.upper() : pal_hls[idx]})
    

print(note_colors)

for string in range(string_num):
    string_y = y_by_line(string, cell_height)
    #test_pitch = nts[string]
    
    for note in range(string_notes):
        cell_start_x = note*cell_width
        cell_start_y = string_y
        cell_middle_x = cell_start_x + (cell_width/2)
        cell_middle_y = cell_start_y + (cell_height/2)
        circle_radius = ((cell_height/2)/10) * 7
        
        #if note>0:
        #    test_pitch = test_pitch.transpose(1)
        
        grp = sw.container.Group()
        if not nts[string][note].accidental:
            note_color_attrs = circ_attrs.update({'fill' : note_colors[nts[string][note].step]})
        else:
            note_color_attrs = circ_attrs.update({'fill' : '#999'})
        svg_els = [
            sw.shapes.Rect(insert=(cell_start_x, cell_start_y), size=(cell_width, cell_height), **cell_attrs),
            sw.shapes.Circle(center=(cell_middle_x, cell_middle_y), r=circle_radius, **circ_attrs),
            sw.text.Text(nts[string][note].unicodeName, insert=(cell_middle_x, cell_middle_y), **text_attrs),
        ]
        
        for element in svg_els:
            grp.add(element)
            
        dwg.add(grp)
        
    # first element is open
    positions = [
        1, 3, 5, 7, 9, 10, 12
    ]
    
    for pos_begin in positions:
        
        # equal for both
        line_x = pos_begin * cell_width
        upper_y = 0
        lower_y = height
        
        if pos_begin == 1:
            attrs = openstr_attrs
        else:
            attrs = closestr_attrs
            
        grp = sw.container.Group()
        svg_els = [
            sw.shapes.Line(start=(line_x, upper_y), end=(line_x, lower_y), **attrs),
        ]
        
        for element in svg_els:
            grp.add(element)
            
        dwg.add(grp)

display(HTML(dwg.tostring()))
</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-2-15e7a4792b5c&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-intense-fg ansi-bold">     79</span> <span class="ansi-red-fg">#note_names = chromatic.getPitches(&#39;c4&#39;,&#39;b4&#39;)</span>
<span class="ansi-green-intense-fg ansi-bold">     80</span> 
<span class="ansi-green-fg">---&gt; 81</span><span class="ansi-red-fg"> </span><span class="ansi-green-fg">for</span> idx<span class="ansi-blue-fg">,</span>note_name <span class="ansi-green-fg">in</span> enumerate<span class="ansi-blue-fg">(</span>note_names<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     82</span>     note_colors<span class="ansi-blue-fg">.</span>update<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">{</span>note_name<span class="ansi-blue-fg">.</span>upper<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">:</span> pal_hls<span class="ansi-blue-fg">[</span>idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">}</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     83</span> 

<span class="ansi-red-fg">TypeError</span>: &#39;NoneType&#39; object is not iterable</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area code">

</div>
</div>
</div>

</div>
    </div>
  </div>
</body>

</html>
