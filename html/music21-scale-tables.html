<!DOCTYPE html>
<html>
<head><meta charset="utf-8" />
<title>music21-scale-tables</title>

<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>-->
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.19.0/codemirror.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.19.0/mode/python/python.js"></script>

<script>
$(document).ready(function(){
	$('.code').each(function() {

	    var $this = $(this),
		$code = $this.html().trim();

	    $this.empty();

	    var myCodeMirror = CodeMirror(this, {
		value: $code,
		mode: 'python',
		lineNumbers: false,
		readOnly: true,
                lineWrapping: true,
                htmlMode: true,
                matchClosing: true,       
                indentWithTabs: true,
	    });

	});
});
</script>



<style type="text/css">
/* Overrides of notebook CSS for static HTML export */
body {
  overflow: visible;
  padding: 8px;
}

div#notebook {
  overflow: visible;
  border-top: none;
}

@media print {
  div.cell {
    display: block;
    page-break-inside: avoid;
  } 
  div.output_wrapper { 
    display: block;
    page-break-inside: avoid; 
  }
  div.output { 
    display: block;
    page-break-inside: avoid; 
  }
}
</style>

<!-- Custom stylesheet, it must be in the same directory as the html file -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.19.0/codemirror.css">
<link rel="stylesheet" href="https://iacchus.github.io/jupyter-ipython-themes/custom.css">

<!-- Loading mathjax macro -->
</head>
<body>
  <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Music21-Scale-Tables">Music21 Scale Tables<a class="anchor-link" href="#Music21-Scale-Tables">&#182;</a></h1><p>In this notebook we are developing a eye-candy presentation of scale data generated by music21 and our music21 toolchain.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Web-of-Reference">Web of Reference<a class="anchor-link" href="#Web-of-Reference">&#182;</a></h2><h3 id="Music-/-Sheet-Music">Music / Sheet Music<a class="anchor-link" href="#Music-/-Sheet-Music">&#182;</a></h3><ul>
<li><a href="http://web.mit.edu/music21/doc/moduleReference/index.html">music21</a></li>
<li><a href="https://github.com/paulrosen/abcjs">abcjs</a></li>
</ul>
<h3 id="Tables">Tables<a class="anchor-link" href="#Tables">&#182;</a></h3><ul>
<li><a href="https://plim.readthedocs.io/en/latest/syntax.html">plim</a></li>
<li><a href="">pandas</a> / <a href="http://pandas.pydata.org/pandas-docs/version/0.18.1/style.html">style</a></li>
<li><a href="https://d3js.org/">d3.js</a></li>
</ul>
<h3 id="Colors">Colors<a class="anchor-link" href="#Colors">&#182;</a></h3><ul>
<li>matplotlib<ul>
<li><a href="http://stackoverflow.com/questions/27443050/pyplot-colormap-line-by-line">Pyplot colormap line by line – StackOverflow</a></li>
<li><a href="http://matplotlib.org/users/colormaps.html">Choosing Colormaps – Matplotlib</a></li>
<li><a href="http://matplotlib.org/api/cm_api.html">cm (colormap)</a></li>
<li><a href="http://matplotlib.org/api/colors_api.html">colors – Matplotlib</a></li>
</ul>
</li>
<li><a href="https://pypi.python.org/pypi/colormap">colormap (pypi)</a></li>
<li><a href="https://jiffyclub.github.io/palettable">palettable</a> / <a href="https://github.com/jiffyclub/palettable">source</a></li>
<li><a href="https://pypi.python.org/pypi/palette">pallete (pypi)</a></li>
<li><a href="https://pypi.python.org/pypi/colour">colour (pypi)</a></li>
<li><a href="http://ethanschoonover.com/solarized">Solarized Color Scheme</a></li>
<li><a href="http://chrisalbon.com/python/seaborn_color_palettes.html">Seaborn</a></li>
<li><a href="http://colour-science.org/">Colour Science</a></li>
</ul>
<h3 id="Audio">Audio<a class="anchor-link" href="#Audio">&#182;</a></h3><ul>
<li><a href="https://github.com/Tonejs/Tone.js">Tone.js</a></li>
<li><a href="https://github.com/mudcube/MIDI.js">MIDI.js</a></li>
</ul>
<h3 id="Persistency">Persistency<a class="anchor-link" href="#Persistency">&#182;</a></h3><ul>
<li>sqlite3</li>
<li><a href="http://docs.sqlalchemy.org/en/rel_1_1/">sqlalchemy</a></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area code">
from music21 import *
from IPython.display import display, HTML, Image, Audio
import plim
from music21.common.pathTools import relativepath as m21_jupyter_relpath
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area code">
def circleOfFifths():
    fifths = []

    fifthsScale = scale.CyclicalScale('c4', 'p5')
    
    for p in fifthsScale.getPitches('c4', 'c11'):
        
        if key.pitchToSharps(p,'major') <= 7:
            MAJOR = str(p.simplifyEnharmonic().name)
            MINOR = str(key.Key(MAJOR, 'major').relative.tonic.simplifyEnharmonic().name).lower()

        else:
            MAJOR = str(p.getEnharmonic().simplifyEnharmonic().name)
            MINOR = str(key.Key(MAJOR, 'major').relative.tonic.simplifyEnharmonic().name).lower()
        
        fifths.append( [ MAJOR, MINOR ] )

        #fifths.append(p.simplifyEnharmonic())
        
    return fifths
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-returnScale()-function">The returnScale() function<a class="anchor-link" href="#The-returnScale()-function">&#182;</a></h2><p>This function returns a <code>dict()</code> with the data and filename of our generated scale.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[39]:</div>
<div class="inner_cell">
    <div class="input_area code">
def returnScale(tonic='c', mode='major', ownKey = False):
    
    modes = [ 'ionian','dorian','phrygian',
              'lydian','mixolydian','aeolian',
              'locrian','major','minor']
    
    if not mode in modes:
        mode = 'major'
        
    if mode == 'ionian': mode = 'major'
    if mode == 'aeolian': mode = 'minor'

    tonic_pitch = pitch.Pitch(tonic)
    #key_enharmonic = tonic_pitch.getEnharmonic().simplifyEnharmonic().name
    key_enharmonic = tonic_pitch
    scale_sharps = key.pitchToSharps(key_enharmonic, mode)

    #    myfunc = eval("scale.{0}Scale".format(mode.capitalize()))
    scale_func = getattr(scale, "{0}Scale".format(mode.capitalize()))
    real_scale = scale_func(key_enharmonic)
    pitches = real_scale.getPitches()

    scale_name = real_scale.name
    absolute_intervals = []
    relative_intervals = []
    myKeySig = key.KeySignature(scale_sharps)
    
    mystream = stream.Stream()
    
    if ownKey:
        mystream.append(myKeySig)

    for x in range(0, len(pitches)):
        mynote = note.Note(pitches[x])

        absolute_interval = interval.notesToInterval(pitches[0], mynote).directedName
        relative_interval = interval.notesToInterval(pitches[(x-1 if x>0 else 0)], mynote).directedName
        
        absolute_intervals.append(absolute_interval)
        relative_intervals.append(relative_interval)
        
        #mynote.addLyric(absolute_interval)
        #mynote.addLyric(relative_interval)
        
        mystream.append(mynote)
        
    filename = mystream.write()
        
    return {
        'scalename': scale_name,
        'stream' : mystream,
        'filename': filename,
        'ai' : absolute_intervals,
        'ri' : relative_intervals
    }
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Creating-an-Array-with-scale-data">Creating an Array with scale data<a class="anchor-link" href="#Creating-an-Array-with-scale-data">&#182;</a></h2><p>Here we create a bidimensional array with our scale data—a list of lists.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[40]:</div>
<div class="inner_cell">
    <div class="input_area code">
my_data = returnScale()

# we need the filename relative to jupyter notebook, not the python (filesystem)
ipython_nb_filename = m21_jupyter_relpath(my_data['filename'])

my_table_data = [
    [ my_data['scalename'] ],
    [ "<img src='{}'/>".format(ipython_nb_filename) ],
    my_data['ai'], # these are already lists
    my_data['ri']
    ]
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>which is..:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[43]:</div>
<div class="inner_cell">
    <div class="input_area code">
my_table_data

# each list inside it is a row; each element is a column
</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[43]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[[&#39;C major&#39;],
 [&#34;&lt;img src=&#39;scratchdir/tmpu4xxgvg5.ly.png&#39;/&gt;&#34;],
 [&#39;P1&#39;, &#39;M2&#39;, &#39;M3&#39;, &#39;P4&#39;, &#39;P5&#39;, &#39;M6&#39;, &#39;M7&#39;, &#39;P8&#39;],
 [&#39;P1&#39;, &#39;M2&#39;, &#39;M2&#39;, &#39;m2&#39;, &#39;M2&#39;, &#39;M2&#39;, &#39;M2&#39;, &#39;m2&#39;]]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Converting-the-data-array-to-HTML">Converting the data array to HTML<a class="anchor-link" href="#Converting-the-data-array-to-HTML">&#182;</a></h2><p>Here we use python <code>plim</code> library to help us convert the data array to a HTML table, the which we can then present on the Jupyter Notebook.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[46]:</div>
<div class="inner_cell">
    <div class="input_area code">
t2_slim = """
table
"""

for row in my_table_data:
    t2_slim += "\ttr\n"
    for column in row:
        if len(row) == 1:
            t2_slim += "\t\tcaption {}\n".format(column)
        else:
            t2_slim += "\t\ttd {}\n".format(column)
        
table_html = plim.preprocessor(t2_slim)

print(table_html)
</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;table&gt;&lt;tr&gt;&lt;caption&gt;C major&lt;/caption&gt;&lt;/tr&gt;&lt;tr&gt;&lt;caption&gt;&lt;img src=&#39;scratchdir/tmpu4xxgvg5.ly.png&#39;/&gt;&lt;/caption&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;P1&lt;/td&gt;&lt;td&gt;M2&lt;/td&gt;&lt;td&gt;M3&lt;/td&gt;&lt;td&gt;P4&lt;/td&gt;&lt;td&gt;P5&lt;/td&gt;&lt;td&gt;M6&lt;/td&gt;&lt;td&gt;M7&lt;/td&gt;&lt;td&gt;P8&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;P1&lt;/td&gt;&lt;td&gt;M2&lt;/td&gt;&lt;td&gt;M2&lt;/td&gt;&lt;td&gt;m2&lt;/td&gt;&lt;td&gt;M2&lt;/td&gt;&lt;td&gt;M2&lt;/td&gt;&lt;td&gt;M2&lt;/td&gt;&lt;td&gt;m2&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Displaying-the-table">Displaying the table<a class="anchor-link" href="#Displaying-the-table">&#182;</a></h2><p>Then we can show the IPython.display to show the HTML table.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[49]:</div>
<div class="inner_cell">
    <div class="input_area code">
HTML(table_html)
</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[49]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<table><tr><caption>C major</caption></tr><tr><caption><img src='scratchdir/tmpu4xxgvg5.ly.png'/></caption></tr><tr><td>P1</td><td>M2</td><td>M3</td><td>P4</td><td>P5</td><td>M6</td><td>M7</td><td>P8</td></tr><tr><td>P1</td><td>M2</td><td>M2</td><td>m2</td><td>M2</td><td>M2</td><td>M2</td><td>m2</td></tr></table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area code">

</div>
</div>
</div>

</div>
    </div>
  </div>
</body>

</html>
