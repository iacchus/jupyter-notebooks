<!DOCTYPE html>
<html>
<head><meta charset="utf-8" />
<title>music21-scale-tables-004</title>

<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>-->
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.19.0/codemirror.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.19.0/mode/python/python.js"></script>

<script>
$(document).ready(function(){
	$('.code').each(function() {

	    var $this = $(this),
		$code = $this.html().trim();

	    $this.empty();

	    var myCodeMirror = CodeMirror(this, {
		value: $code,
		mode: 'python',
		lineNumbers: false,
		readOnly: true,
                lineWrapping: true,
                htmlMode: true,
                matchClosing: true,       
                indentWithTabs: true,
	    });

	});
});
</script>



<style type="text/css">
/* Overrides of notebook CSS for static HTML export */
body {
  overflow: visible;
  padding: 8px;
}

div#notebook {
  overflow: visible;
  border-top: none;
}

@media print {
  div.cell {
    display: block;
    page-break-inside: avoid;
  } 
  div.output_wrapper { 
    display: block;
    page-break-inside: avoid; 
  }
  div.output { 
    display: block;
    page-break-inside: avoid; 
  }
}
</style>

<!-- Custom stylesheet, it must be in the same directory as the html file -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.19.0/codemirror.css">
<link rel="stylesheet" href="https://iacchus.github.io/jupyter-ipython-themes/custom.css">

<!-- Loading mathjax macro -->
</head>
<body>
  <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Music21-Scale-Tables">Music21 Scale Tables<a class="anchor-link" href="#Music21-Scale-Tables">&#182;</a></h1><p>In this notebook we are developing a eye-candy presentation of scale data generated by music21 and our music21 toolchain.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Web-of-Reference">Web of Reference<a class="anchor-link" href="#Web-of-Reference">&#182;</a></h2><h3 id="Music-/-Sheet-Music">Music / Sheet Music<a class="anchor-link" href="#Music-/-Sheet-Music">&#182;</a></h3><ul>
<li><a href="http://web.mit.edu/music21/doc/moduleReference/index.html">music21</a></li>
<li><a href="https://github.com/paulrosen/abcjs">abcjs</a></li>
</ul>
<h3 id="Tables">Tables<a class="anchor-link" href="#Tables">&#182;</a></h3><ul>
<li><a href="https://plim.readthedocs.io/en/latest/syntax.html">plim</a></li>
<li><a href="">pandas</a> / <a href="http://pandas.pydata.org/pandas-docs/version/0.18.1/style.html">style</a></li>
<li><a href="https://d3js.org/">d3.js</a></li>
</ul>
<h3 id="Colors">Colors<a class="anchor-link" href="#Colors">&#182;</a></h3><ul>
<li>matplotlib<ul>
<li><a href="http://stackoverflow.com/questions/27443050/pyplot-colormap-line-by-line">Pyplot colormap line by line – StackOverflow</a></li>
<li><a href="http://matplotlib.org/users/colormaps.html">Choosing Colormaps – Matplotlib</a></li>
<li><a href="http://matplotlib.org/api/cm_api.html">cm (colormap)</a></li>
<li><a href="http://matplotlib.org/api/colors_api.html">colors – Matplotlib</a></li>
</ul>
</li>
<li><a href="https://pypi.python.org/pypi/colormap">colormap (pypi)</a></li>
<li><a href="https://jiffyclub.github.io/palettable">palettable</a> / <a href="https://github.com/jiffyclub/palettable">source</a></li>
<li><a href="https://pypi.python.org/pypi/palette">pallete (pypi)</a></li>
<li><a href="https://pypi.python.org/pypi/colour">colour (pypi)</a></li>
<li><a href="http://ethanschoonover.com/solarized">Solarized Color Scheme</a></li>
<li><a href="http://chrisalbon.com/python/seaborn_color_palettes.html">Seaborn</a></li>
<li><a href="http://colour-science.org/">Colour Science</a></li>
</ul>
<h3 id="Audio">Audio<a class="anchor-link" href="#Audio">&#182;</a></h3><ul>
<li><a href="https://github.com/Tonejs/Tone.js">Tone.js</a></li>
<li><a href="https://github.com/mudcube/MIDI.js">MIDI.js</a></li>
</ul>
<h3 id="Persistency">Persistency<a class="anchor-link" href="#Persistency">&#182;</a></h3><ul>
<li>sqlite3</li>
<li><a href="http://docs.sqlalchemy.org/en/rel_1_1/">sqlalchemy</a></li>
</ul>
<h3 id="etc">etc<a class="anchor-link" href="#etc">&#182;</a></h3><ul>
<li><a href="https://ipython.org/ipython-doc/3/interactive/magics.html">Jupyter Magics</a></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[76]:</div>
<div class="inner_cell">
    <div class="input_area code">
from music21 import *
from IPython.display import display, HTML, Image, Audio
import plim
import base64
#from music21.common.pathTools import relativepath as m21_jupyter_relpath
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[77]:</div>
<div class="inner_cell">
    <div class="input_area code">
def circleOfFifths():
    fifths = []

    fifthsScale = scale.CyclicalScale('c4', 'p5')
    
    for p in fifthsScale.getPitches('c4', 'c11'):
        
        if key.pitchToSharps(p,'major') <= 7:
            MAJOR = str(p.simplifyEnharmonic().name)
            MINOR = str(key.Key(MAJOR, 'major').relative.tonic.simplifyEnharmonic().name).lower()

        else:
            MAJOR = str(p.getEnharmonic().simplifyEnharmonic().name)
            MINOR = str(key.Key(MAJOR, 'major').relative.tonic.simplifyEnharmonic().name).lower()
        
        fifths.append( [ MAJOR, MINOR ] )

        #fifths.append(p.simplifyEnharmonic())
        
    return fifths
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-returnScale()-function">The returnScale() function<a class="anchor-link" href="#The-returnScale()-function">&#182;</a></h2><p>This function returns a <code>dict()</code> with the data and filename of our generated scale.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[78]:</div>
<div class="inner_cell">
    <div class="input_area code">
def returnScale(tonic='c', mode='major', ownKey=False):
    
    modes = [ 'ionian','dorian','phrygian',
              'lydian','mixolydian','aeolian',
              'locrian','major','minor']
    
    if not mode in modes: mode = 'major'
        
    if mode == 'ionian': mode = 'major'
    if mode == 'aeolian': mode = 'minor'

    tonic_pitch = pitch.Pitch(tonic)
    #key_enharmonic = tonic_pitch.getEnharmonic().simplifyEnharmonic().name
    key_enharmonic = tonic_pitch
    scale_sharps = key.pitchToSharps(key_enharmonic, mode)

    #    myfunc = eval("scale.{0}Scale".format(mode.capitalize()))
    scale_func = getattr(scale, "{0}Scale".format(mode.capitalize()))
    real_scale = scale_func(key_enharmonic)
    pitches = real_scale.getPitches()

    scale_name = real_scale.name
    absolute_intervals = []
    relative_intervals = []
    myKeySig = key.KeySignature(scale_sharps)
    
    mystream = stream.Stream()
    
    if ownKey:
        mystream.append(myKeySig)

    for cur_pitch in pitches:
        mynote = note.Note(cur_pitch)

        cur_degree = real_scale.getScaleDegreeFromPitch(cur_pitch)
        past_degree_or_tonic = cur_degree-1 if cur_degree>1 else 1
        
        absolute_interval = real_scale.intervalBetweenDegrees(1,cur_degree).name
        relative_interval = real_scale.intervalBetweenDegrees(past_degree_or_tonic, cur_degree).name
        
        absolute_intervals.append([absolute_interval,])
        relative_intervals.append([relative_interval,])
        
        mynote.addLyric(absolute_interval)
        mynote.addLyric(relative_interval)
        
        mystream.append(mynote)
        
    filename = mystream.write()
        
    return {
        'scalename': scale_name,
        'stream' : mystream,
        'filename': filename,
        'ai' : absolute_intervals,
        'ri' : relative_intervals
    }
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Creating-an-Array-with-scale-data">Creating an Array with scale data<a class="anchor-link" href="#Creating-an-Array-with-scale-data">&#182;</a></h2><p>Here we create a bidimensional array with our scale data—a list of lists.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[79]:</div>
<div class="inner_cell">
    <div class="input_area code">
#my_data = returnScale(scale_data)
def generate_table_array(scale_data):
    
    # lets embed the image
    with open(scale_data['filename'],'rb') as image_file:
        b64_image_data = base64.b64encode(image_file.read()).decode('utf8')

    imgtag  = "<img src='data:image/png;charset=utf-8;base64,{}' />".format(b64_image_data)

    my_table_data = [
        [ [scale_data['scalename'],''] ],
        [ [imgtag,'style="padding:0;"'] ],
        scale_data['ai'], # these are already lists
        scale_data['ri']
        ]
    return my_table_data

#array = [
#    [ (data, cell attributes) ]
#]
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Converting-the-data-array-to-HTML">Converting the data array to HTML<a class="anchor-link" href="#Converting-the-data-array-to-HTML">&#182;</a></h2><p>Here we use python <code>plim</code> library to help us convert the data array to a HTML table, the which we can then present on the Jupyter Notebook.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[80]:</div>
<div class="inner_cell">
    <div class="input_area code">
def array_to_htmltable(data):
    t2_slim = """
table style='float: left;'
"""

    for row in data:
        t2_slim += "\ttr\n"
        for column in row:
            
            if type(column) == list and len(column)>1:
                attrs = column[1]
            else: attrs = '';
                
            if type(column) == list:
                column = column[0]
                
            if len(row) == 1:
                t2_slim += "\t\tcaption {0} {1}\n".format(attrs, str(column))
            else:
                t2_slim += "\t\ttd {0} {1}\n".format(attrs, str(column))

    return plim.preprocessor(t2_slim)
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Displaying-the-table">Displaying the table<a class="anchor-link" href="#Displaying-the-table">&#182;</a></h2><p>Then we can show the IPython.display to show the HTML table.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[81]:</div>
<div class="inner_cell">
    <div class="input_area code">
Fifths = circleOfFifths()

Fifths
</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[81]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>[[&#39;C&#39;, &#39;a&#39;],
 [&#39;G&#39;, &#39;e&#39;],
 [&#39;D&#39;, &#39;b&#39;],
 [&#39;A&#39;, &#39;f#&#39;],
 [&#39;E&#39;, &#39;c#&#39;],
 [&#39;B&#39;, &#39;g#&#39;],
 [&#39;F#&#39;, &#39;d#&#39;],
 [&#39;C#&#39;, &#39;a#&#39;],
 [&#39;A-&#39;, &#39;f&#39;],
 [&#39;E-&#39;, &#39;c&#39;],
 [&#39;B-&#39;, &#39;g&#39;],
 [&#39;F&#39;, &#39;d&#39;],
 [&#39;C&#39;, &#39;a&#39;]]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="scale_data-=-returnScale('c','maior',ownKey=True)">scale_data = returnScale('c','maior',ownKey=True)<a class="anchor-link" href="#scale_data-=-returnScale('c','maior',ownKey=True)">&#182;</a></h1><p>table_array = generate_table_array(scale_data)
html_table = array_to_htmltable(table_array)</p>
<p>display(HTML(html_table))</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area code">

</div>
</div>
</div>

</div>
    </div>
  </div>
</body>

</html>
