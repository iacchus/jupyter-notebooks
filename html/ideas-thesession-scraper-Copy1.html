<!DOCTYPE html>
<html>
<head><meta charset="utf-8" />
<title>ideas-thesession-scraper-Copy1</title>

<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>-->
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.19.0/codemirror.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.19.0/mode/python/python.js"></script>

<script>
$(document).ready(function(){
	$('.code').each(function() {

	    var $this = $(this),
		$code = $this.html().trim();

	    $this.empty();

	    var myCodeMirror = CodeMirror(this, {
		value: $code,
		mode: 'python',
		lineNumbers: false,
		readOnly: true,
                lineWrapping: true,
                htmlMode: true,
                matchClosing: true,       
                indentWithTabs: true,
	    });

	});
});
</script>



<style type="text/css">
/* Overrides of notebook CSS for static HTML export */
body {
  overflow: visible;
  padding: 8px;
}

div#notebook {
  overflow: visible;
  border-top: none;
}

@media print {
  div.cell {
    display: block;
    page-break-inside: avoid;
  } 
  div.output_wrapper { 
    display: block;
    page-break-inside: avoid; 
  }
  div.output { 
    display: block;
    page-break-inside: avoid; 
  }
}
</style>

<!-- Custom stylesheet, it must be in the same directory as the html file -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.19.0/codemirror.css">
<link rel="stylesheet" href="https://iacchus.github.io/jupyter-ipython-themes/custom.css">

<!-- Loading mathjax macro -->
</head>
<body>
  <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="The-Session-Scraper">The Session Scraper<a class="anchor-link" href="#The-Session-Scraper">&#182;</a></h1><ul>
<li><a href="https://thesession.org/">The Session</a></li>
<li><a href="http://docs.python-guide.org/en/latest/scenarios/scrape/">HTML Scrapingâ€”The Hitchhiker's Guide to Python</a></li>
<li><a href="https://doc.scrapy.org/en/1.2/intro/overview.html">https://doc.scrapy.org/en/1.2/intro/overview.html</a></li>
<li><a href="https://doc.scrapy.org/en/1.2/intro/examples.html">https://doc.scrapy.org/en/1.2/intro/examples.html</a></li>
<li><a href="https://doc.scrapy.org/en/1.2/intro/tutorial.html">https://doc.scrapy.org/en/1.2/intro/tutorial.html</a></li>
<li><a href="https://doc.scrapy.org/en/1.2/topics/spiders.html">https://doc.scrapy.org/en/1.2/topics/spiders.html</a></li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area code">
import scrapy
import re
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area code">
class TunePipeline(object):
    
    def process_item(self, item, spider):
        print(item)

class TuneScraper(scrapy.Spider):
    name = 'thesession-tunes'
    tunes = []
    tune = {}
    custom_settings = {
        'ITEM_PIPELINES' : 'TunePipeline',
    }
    
    def __init__(self, *baahrg, **doitbabe):
        super(TuneScraper, self).__init__(*baahrg, **doitbabe)
        
        
    def start_requests(self, tune_id):
        url = "https://thesession.org/tunes/{}".format(tune_id)
        
        yield scrapy.Request(url=url, callback=self.parse)
        
    def parse(self, response):
        
        abc_list = []

        name = response.css('//main/div[@class="contents"]/h1/text()').extract()
        style = response.css('//main/div[@class="contents"]/h1/span/a/text()').extract()

        for item in response.xpath("//div[@class='notes']"):
            text = item.extract()
            abc = re.sub('<[^<]+?>', '', text)
            
            abc_list.append(abc)
            
        tune = {
            'name' : name,
            'style' : style,
            'abc_list' : abc_list,
            }
        
        yield tune
        
</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area code">
TuneScraper(10)
</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[11]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>&lt;TuneScraper 10 at 0x7f75b998ec18&gt;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area code">
a = TuneScraper(10)

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area code">
a.tune
</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[7]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>{}</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div>
<div class="inner_cell">
    <div class="input_area code">

</div>
</div>
</div>

</div>
    </div>
  </div>
</body>

</html>
